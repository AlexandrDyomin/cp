function t(t,e,a,n){Object.defineProperty(t,e,{get:a,set:n,enumerable:!0,configurable:!0})}var e=globalThis,a={},n={},r=e.parcelRequire8123;null==r&&((r=function(t){if(t in a)return a[t].exports;if(t in n){var e=n[t];delete n[t];var r={id:t,exports:{}};return a[t]=r,e.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(t,e){n[t]=e},e.parcelRequire8123=r);var i=r.register;i("lXqOp",function(e,a){t(e.exports,"makeFuncOpenModalWindow",()=>n);function n(t,{action:e}){return()=>{t.dataset.action=e,t.showModal()}}}),i("bgTL1",function(e,a){t(e.exports,"modal",()=>n),t(e.exports,"modalFields",()=>r),t(e.exports,"saveBtn",()=>i);let n=document.querySelector(".modal"),r=[...n.querySelectorAll("*[name]")],i=n.querySelector(".modal-btn_ok");n.addEventListener("input",()=>{r.filter(t=>"id"!==t.name&&"total"!==t.name).every(t=>!("number"===t.type&&0>=+t.value)&&!!t.value)?i.removeAttribute("disabled"):i.setAttribute("disabled",!0)}),n.addEventListener("close",()=>{n.dataset.action="",r.forEach(t=>t.value=""),i.setAttribute("disabled",!0)})}),i("7SWjB",function(e,a){function n(t=()=>console.log("Соединение с БД установлено")){let e=indexedDB.open("cp");e.onupgradeneeded=function(t){let e=t.target.result;e.createObjectStore("wallet",{keyPath:"id",autoIncrement:!0}).createIndex("coinIdx","coin",{unique:!0}),e.createObjectStore("transactions",{keyPath:"id",autoIncrement:!0}).createIndex("coinIdx","pair")},e.onsuccess=t,e.onerror=function(t){console.error("Error",t.target.error)}}function r(t,e){return a=>{i(a,t,"readonly").getAll().onsuccess=t=>{e(t.target.result)}}}function i(t,e,a){return t.target.result.transaction(e,a).objectStore(e)}t(e.exports,"connectDB",()=>n),t(e.exports,"makeReadAllRecords",()=>r),t(e.exports,"startTransaction",()=>i)}),i("iFviF",function(t,e){t.exports=import.meta.resolve("8ksLu")}),i("d69wW",function(t,e){t.exports=import.meta.resolve("cm9mC")}),i("lT6Ry",function(e,a){t(e.exports,"collectData",()=>n);function n(t,...e){return[...t].reduce((t,a)=>{if(e.includes(a.name))return t;let n="number"===a.type?+a.value:a.value.trim();return"pair"===a.id&&(n=a.value.toLowerCase()),n&&(t[a.name]=n),t},{})}}),i("fJadv",function(e,a){t(e.exports,"renderRows",()=>n);function n(t,e,a){let n=[];e.forEach(t=>n.push(a(t))),t.append(...n)}}),i("aKRUb",function(e,a){t(e.exports,"updateRow",()=>n);function n(t,e){for(let[a,n]of Object.entries(e))t.dataset[a]=n;t.dataset.timeUpdate=Date.now()}}),i("iL6GR",function(t,e){customElements.define("custom-nav",class extends HTMLElement{connectedCallback(){let t=this.dataset.activeLink;setTimeout(()=>{this.querySelector(`li:nth-child(${t})`).className="navigation__list-item_active"},0),this.innerHTML=`
            <nav class="navigation">
                <ul class="navigation__list">
                    <li>
                        <a class="navigation__link" href="/" title="\u{41A}\u{43E}\u{448}\u{435}\u{43B}\u{435}\u{43A}">
                            <img class="navigation__img" src="${"/cp"+new URL(r("1df7L"))}" alt="\u{41A}\u{43E}\u{448}\u{435}\u{43B}\u{451}\u{43A}">
                        </a>
                    </li>
                    <li>
                        <a class="navigation__link" href="/transactions" title="\u{422}\u{440}\u{430}\u{43D}\u{437}\u{430}\u{43A}\u{446}\u{438}\u{438}">
                            <img class="navigation__img" src="${"/cp"+new URL(r("6Vp7X"))}" alt="\u{411}\u{443}\u{445}\u{433}\u{430}\u{43B}\u{442}\u{435}\u{440}\u{441}\u{43A}\u{430}\u{44F} \u{43A}\u{43D}\u{438}\u{433}\u{430}">
                        </a>
                    </li>
                    <li>
                        <a class="navigation__link" href="/realizedPnL" title="\u{420}\u{435}\u{430}\u{43B}\u{438}\u{437}\u{43E}\u{432}\u{430}\u{43D}\u{43D}\u{44B}\u{439} PnL">
                            <img class="navigation__img" src="${"/cp"+new URL(r("imq0f"))}" alt="\u{420}\u{443}\u{43A}\u{430} \u{441} \u{43C}\u{435}\u{448}\u{435}\u{447}\u{43A}\u{43E}\u{43C} \u{434}\u{43B}\u{44F} \u{434}\u{435}\u{43D}\u{435}\u{433}">
                        </a>
                    </li>
                    <li>
                        <a class="navigation__link" href="/unrealizedPnL" title="\u{41D}\u{435}\u{440}\u{435}\u{430}\u{43B}\u{438}\u{437}\u{43E}\u{432}\u{430}\u{43D}\u{43D}\u{44B}\u{439} PnL">
                            <img class="navigation__img" src="${"/cp"+new URL(r("3BkXQ"))}" alt="\u{413}\u{438}\u{441}\u{442}\u{43E}\u{433}\u{440}\u{430}\u{43C}\u{43C}\u{430}">
                        </a>
                    </li>
                </ul>
            </nav>
        `}})}),i("1df7L",function(t,e){t.exports=import.meta.resolve("JhyDX")}),i("6Vp7X",function(t,e){t.exports=import.meta.resolve("5IJ5w")}),i("imq0f",function(t,e){t.exports=import.meta.resolve("i5U7f")}),i("3BkXQ",function(t,e){t.exports=import.meta.resolve("caGxo")}),i("3KRaD",function(e,a){t(e.exports,"makeHandlerOpenModal",()=>i);var n=r("lXqOp");function i(t,e){return a=>{a.target.closest(".edit-btn")&&(0,n.makeFuncOpenModalWindow)(t,e)()}}}),i("du2jG",function(e,a){t(e.exports,"makeFuncFillModal",()=>n);function n({modalClassName:t,rowTableClassName:e,cellsClassNames:a}){return n=>{let r=n.target;if(!r.closest(".edit-btn"))return;let i=r.closest("."+e),o=i.dataset.id,s=[document.createTextNode(o),...a.map(t=>i.querySelector(`.${t}`))];document.querySelector("."+t).querySelectorAll("*[name]").forEach((t,e)=>{if("datetime-local"===t.type){t.value=s[e].dateTime;return}if("number"===t.type){t.value=s[e].textContent.replace(",",".");return}t.value=s[e].textContent})}}}),i("cEcEw",function(t,e){(document.querySelector(".coins")||document.querySelector(".transactions")).addEventListener("click",function(t){t.target.closest(".delete-btn")&&(t.target.closest(".coins__record")||t.target.closest(".transactions__record")).remove()})});var o=r("lXqOp");let s=document.querySelector(".transaction");document.querySelector(".add-transaction").addEventListener("click",(0,o.makeFuncOpenModalWindow)(s,{action:"add"}));var u=r("bgTL1"),c=r("7SWjB");class l extends HTMLTableSectionElement{constructor(t={},e=!1){super(),this.requiredSaveToDb=e,this.setAttribute("is","custom-transaction"),this.className="transactions__record";let{id:a,date:n,pair:r,transactionType:i,amount:o,price:s}=t,{dataset:u}=this;u.id=a||u.id||"",u.date=n||u.date||"",u.pair=r||u.pair||"",u.transactionType=i||u.transactionType||"",u.amount=o||u.amount||"",u.price=s||u.price||"",u.total=(o*s).toFixed(2),u.timeUpdate=Date.now()}connectedCallback(){this.requiredSaveToDb&&this.saveData();let{date:t,pair:e,transactionType:a,amount:n,price:i,total:o}=this.dataset;this.innerHTML=`
            <tr class="transactions__first-row">
                <td colspan="2">
                    <div class="transactions__date">
                        <button class="small-btn delete-btn" title="\u{423}\u{434}\u{430}\u{43B}\u{438}\u{442}\u{44C}">
                            <img src="${new URL(r("iFviF"))} alt="\u{41A}\u{43E}\u{440}\u{437}\u{438}\u{43D}\u{430}">
                        </button>
                        <time datetime=${t}>${this.formatDate(t)}</time>
                        <button class="small-btn edit-btn" title="\u{420}\u{435}\u{434}\u{430}\u{43A}\u{442}\u{438}\u{440}\u{43E}\u{432}\u{430}\u{442}\u{44C}">
                            <img src="${new URL(r("d69wW"))} alt="\u{420}\u{443}\u{447}\u{43A}\u{430} \u{43F}\u{435}\u{440}\u{44C}\u{435}\u{432}\u{430}\u{44F}">
                        </button>
                    </div>
                </td>
            </tr>
            <tr>
                <th>\u{41F}\u{430}\u{440}\u{430}</th>
                <td class="transactions__pair">${e}</td>    
            </tr>
                <tr>
                <th>\u{412}\u{438}\u{434} \u{442}\u{440}\u{430}\u{43D}\u{437}\u{430}\u{43A}\u{446}\u{438}\u{438}</th>
                <td class="transactions__type ${"Покупка"===a?"transactions__type_green":"transactions__type_red"}">${a}</td>  
            </tr>
            <tr>
                <th>\u{41A}\u{43E}\u{43B}\u{438}\u{447}\u{435}\u{441}\u{442}\u{432}\u{43E}</th>
                <td class="transactions__amount">${n}</td>
            </tr>
            <tr>
                <th>\u{426}\u{435}\u{43D}\u{430}</th>
                <td class="transactions__price">${i}</td>
            </tr>
            <tr>
                <th>\u{421}\u{442}\u{43E}\u{438}\u{43C}\u{43E}\u{441}\u{442}\u{44C}</th>
                <td class="transactions__total-price">${o}</td>
            </tr>
        `}disconnectedCallback(){let{id:t}=this.dataset;(0,c.connectDB)(e=>{(0,c.startTransaction)(e,"transactions","readwrite").delete(+t)}),document.dispatchEvent(new CustomEvent("transaction-deleted",{detail:this.dataset}))}static get observedAttributes(){return["data-time-update"]}attributeChangedCallback(t,e,a){if(null===e)return;(0,c.connectDB)((function(t){let e=(0,c.startTransaction)(t,"transactions","readonly").get(+this.dataset.id);e.onsuccess=()=>{let t={pair:this.dataset.pair,transactionType:this.dataset.transactionType,amount:+this.dataset.amount,total:+this.dataset.total},a=e.result,n={pair:a.pair,transactionType:a.transactionType,amount:a.amount,total:a.price*a.amount};document.dispatchEvent(new CustomEvent("transaction-changed",{detail:{oldData:n,newData:t}}))}}).bind(this)),this.saveData();let n=["date","pair","transactionType","amount","price","total"];[".transactions__date time",".transactions__pair",".transactions__type",".transactions__amount",".transactions__price",".transactions__total-price"].forEach((t,e)=>{let a=this.querySelector(t);if(".transactions__date time"===t){a.datetime=this.dataset.date,a.textContent=this.formatDate(this.dataset.date);return}".transactions__type"===t&&(a.className="transactions__type "+("Покупка"===this.dataset.transactionType?"transactions__type_green":"transactions__type_red")),a.textContent=this.dataset[n[e]]}),this.style.animation="backlight 3s",this.firstElementChild.style.animation="colorlight 3s",setTimeout(()=>{this.firstElementChild.style.animation="",this.style.animation=""},3e3)}formatDate(t){return new Date(t).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})}saveData(){let{id:t,date:e,pair:a,transactionType:n,amount:r,price:i}=this.dataset,o={date:e,transactionType:n,pair:a,amount:+r,price:+i};t&&(o.id=+t);let s=t=>{(0,c.startTransaction)(t,"transactions","readwrite").put(o).onsuccess=t=>{let e=t.target.result;this.dataset.id=e}};(0,c.connectDB)(s)}}customElements.define("custom-transaction",l,{extends:"tbody"});var d=r("lT6Ry"),m=r("fJadv"),p=r("aKRUb"),c=(r("7SWjB"),r("7SWjB"));function _(t,e,a){let n=(0,c.startTransaction)(t,"wallet","readwrite"),r=n.index("coinIdx").get(e);r.onsuccess=()=>{let t=r.result;return t?t.amount+=a:t={coin:e,amount:a},n.put(t)}}let f=u.modal.querySelector("input[name=amount]"),v=u.modal.querySelector("input[name=price]"),h=u.modal.querySelector("input[name=total]"),y=document.querySelector(".transactions");u.modal.addEventListener("input",function(t){let{target:e}=t;["amount","price"].includes(e.name)&&(h.value=f.value*v.value)}),u.saveBtn.addEventListener("click",()=>{var t,e;let a=u.modal.dataset.action,n=(0,d.collectData)(u.modalFields);(t=a,e=n,({add:()=>(0,m.renderRows)(y,[e],t=>new l(t,!0)),edit:()=>(0,p.updateRow)(y.querySelector(`.transactions__record[data-id="${e.id}"]`),e)})[t])(),"add"===a&&(0,c.connectDB)(t=>{let e=n.pair.split("/");"Покупка"===n.transactionType&&(_(t,e[0],+n.amount),_(t,e[1],-1*n.total)),"Продажа"===n.transactionType&&(_(t,e[0],-1*n.amount),_(t,e[1],+n.total))}),u.modal.close()}),r("iL6GR");var g=r("3KRaD"),b=r("du2jG");let T=document.querySelector(".transactions"),D=document.querySelector(".transaction");T.addEventListener("click",(0,g.makeHandlerOpenModal)(D,{action:"edit"})),T.addEventListener("click",(0,b.makeFuncFillModal)({modalClassName:"transaction",rowTableClassName:"transactions__record",cellsClassNames:["transactions__date time","transactions__pair","transactions__type","transactions__amount","transactions__price","transactions__total-price"]})),r("cEcEw");var c=r("7SWjB"),m=r("fJadv");let E=document.querySelector(".transactions");(0,c.connectDB)((0,c.makeReadAllRecords)("transactions",t=>{(0,m.renderRows)(E,t,t=>new l(t))})),document.addEventListener("transaction-changed",function(t){let{oldData:e,newData:a}=t.detail;(0,c.connectDB)(function(t){let n=(0,c.startTransaction)(t,"wallet","readwrite"),r=n.index("coinIdx"),i=e.pair?.split("/"),o=a.pair?.split("/");if("Покупка"===e.transactionType)return void Promise.all([s(i[0],-1*e.amount),s(i[1],e.total)]).then(()=>{if("Покупка"===a.transactionType){s(o[0],a.amount),s(o[1],-1*a.total);return}if("Продажа"===a.transactionType){s(o[0],-1*a.amount),s(o[1],a.total);return}});if("Продажа"===e.transactionType)return void Promise.all([s(i[0],e.amount),s(i[1],-1*e.total)]).then(()=>{if("Продажа"===a.transactionType){s(o[0],-1*a.amount),s(o[1],a.total);return}"Покупка"===a.transactionType&&(s(o[0],a.amount),s(o[1],-1*a.total))});function s(t,e){return new Promise((a,i)=>{let o=r.get(t);o.onsuccess=()=>{let r=o.result;r?r.amount+=e:r={coin:t,amount:e};let s=n.put(r);s.onsuccess=()=>a(s),s.onerror=()=>i(s.error)}})}})}),document.addEventListener("transaction-deleted",t=>{let e=t.detail;(0,c.connectDB)(function(t){let a=e.pair.split("/");"Покупка"===e.transactionType&&(_(t,a[0],-1*e.amount),_(t,a[1],+e.total)),"Продажа"===e.transactionType&&(_(t,a[0],+e.amount),_(t,a[1],-1*e.total))})});